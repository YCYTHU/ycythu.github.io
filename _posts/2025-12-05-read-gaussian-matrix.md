---
title: 使用Python读取Gaussian生成的分块格式矩阵文件
tags: 
- Python
- Quantum Chemistry
cover: https://cdn.jsdelivr.net/gh/ycythu/assets@main/images/cover/FRET.jpg
---
在使用 Gaussian 进行量化计算时，程序会按照固定格式输出各类矩阵（例如重叠矩阵、密度矩阵等）。通常来说，前一行或前数行用于说明信息，随后进入正式的数据部分。矩阵的内容会按照“每五列一组”的方式分块输出：先给出当前分组的列号，再逐行列出行号及对应的五列数据。
<!--more-->
对于下三角矩阵，输出格式与此相同，只是不会包含上三角中不存在的数据部分。

普通矩阵（以系数矩阵为例）和下三角矩阵（以重叠矩阵为例）的典型示例如下：

```text
 **************************** Coefficient matrix ****************************
             1             2             3             4             5      
     1  3.71864E-006  0.00000E+000 -5.89756E-006 -5.97407E-007  0.00000E+000
     2  1.89932E-005  0.00000E+000 -3.03494E-005  2.46912E-006  0.00000E+000
     3  0.00000E+000 -2.03878E-005  0.00000E+000  0.00000E+000 -3.46725E-005
     4 -8.53629E-006  0.00000E+000  1.15089E-005  2.27583E-005  0.00000E+000
     5  0.00000E+000  0.00000E+000  0.00000E+000  0.00000E+000  0.00000E+000
     6 -1.07081E-004  0.00000E+000  2.36449E-004 -7.20967E-004  0.00000E+000
     7  0.00000E+000  3.57670E-004  0.00000E+000  0.00000E+000  9.88191E-005
     8  2.16309E-004  0.00000E+000 -3.46699E-004  2.33406E-004  0.00000E+000
             6             7             8      
     1  1.05099E-005  0.00000E+000 -8.92734E-004
     2  4.43052E-005  0.00000E+000 -1.98249E-004
     3  0.00000E+000  1.98985E-006  0.00000E+000
     4 -1.82804E-006  0.00000E+000  1.99084E-006
     5  0.00000E+000  0.00000E+000  0.00000E+000
     6 -8.64026E-004  0.00000E+000  2.56960E-003
     7  0.00000E+000  3.19972E-005  0.00000E+000
     8  7.40894E-004  0.00000E+000 -1.33186E-003
```
```text
 ****************************** Overlap matrix ******************************
             1             2             3             4             5      
     1  1.00000E+000
     2  2.19059E-001  1.00000E+000
     3  4.96995E-025  4.18154E-025  1.00000E+000
     4  9.52700E-017  0.00000E+000  0.00000E+000  1.00000E+000
     5  3.45561E-034  7.92386E-034  1.85179E-057  0.00000E+000  1.00000E+000
     6  1.84261E-001  8.12273E-001 -9.55356E-025 -6.28313E-016  0.00000E+000
     7  0.00000E+000 -5.76860E-025  5.69754E-001  4.26956E-040  0.00000E+000
     8  1.55645E-016  9.56506E-017  4.26956E-040  5.69754E-001  0.00000E+000
             6             7             8      
     6  1.00000E+000
     7  0.00000E+000  1.00000E+000
     8  0.00000E+000  0.00000E+000  1.00000E+000
```

在需要对 Gaussian 输出的矩阵进行进一步的自定义计算时，首先要将其从分块格式还原为常见的二维矩阵结构。下面给出一段使用 Python 进行读取与重构的示例代码：

```python
import numpy as np

def read_gaussian_lower_triangle(txt_path, start, column_count, to_full=True):
    lines=open(txt_path).readlines()[start-1:]
    d=[0]+[sum(list(range(column_count+1,0,-5))[:i+1]) for i in range(column_count//5)]
    il=[l.split()[1:] for c,l in enumerate(lines) if c not in d]
    lm=[np.cumsum([i]+list(range(column_count-5,0,-5))[:i//5]).tolist() for i in range(column_count)]
    lt=[sum([il[j] for j in idx],[]) for idx in lm]
    if to_full:
        return np.array([[lt[j][i] if i<=j else lt[i][j] for i in range(len(lt))] for j in range(len(lt))], dtype=float)
    return np.array([row + [np.nan]*(column_count-len(row)) for row in lt], dtype=float)

def read_gaussian_full_matrix(txt_path, start, column_count):
    lines=open(txt_path).readlines()[start-1:]
    d=[0]+[(column_count+1)*(i+1) for i in range((column_count-1)//5)]
    il=[l.split()[1:] for c,l in enumerate(lines) if c not in d]
    lm=[[b+bias for b in [0]+[column_count*(i+1) for i in range((column_count-1)//5)]] 
          for bias in range(column_count)]
    return np.array([sum([il[j] for j in idx], []) for idx in lm], dtype=float)
```


```text
In [1]: read_gaussian_full_matrix("CoeffMatrix.txt", 2, 8)
```
```text
Out[1]: 
array([[ 3.71864e-06,  0.00000e+00, -5.89756e-06, -5.97407e-07,
         0.00000e+00,  1.05099e-05,  0.00000e+00, -8.92734e-04],
       [ 1.89932e-05,  0.00000e+00, -3.03494e-05,  2.46912e-06,
         0.00000e+00,  4.43052e-05,  0.00000e+00, -1.98249e-04],
       [ 0.00000e+00, -2.03878e-05,  0.00000e+00,  0.00000e+00,
        -3.46725e-05,  0.00000e+00,  1.98985e-06,  0.00000e+00],
       [-8.53629e-06,  0.00000e+00,  1.15089e-05,  2.27583e-05,
         0.00000e+00, -1.82804e-06,  0.00000e+00,  1.99084e-06],
       [ 0.00000e+00,  0.00000e+00,  0.00000e+00,  0.00000e+00,
         0.00000e+00,  0.00000e+00,  0.00000e+00,  0.00000e+00],
       [-1.07081e-04,  0.00000e+00,  2.36449e-04, -7.20967e-04,
         0.00000e+00, -8.64026e-04,  0.00000e+00,  2.56960e-03],
       [ 0.00000e+00,  3.57670e-04,  0.00000e+00,  0.00000e+00,
         9.88191e-05,  0.00000e+00,  3.19972e-05,  0.00000e+00],
       [ 2.16309e-04,  0.00000e+00, -3.46699e-04,  2.33406e-04,
         0.00000e+00,  7.40894e-04,  0.00000e+00, -1.33186e-03]])
```
```text
In [2]: read_gaussian_lower_triangle("OverlapMatrix.txt", 2, 8, False)
```
```text
Out[2]: 
array([[ 1.00000e+00,          nan,          nan,          nan,
                 nan,          nan,          nan,          nan],
       [ 2.19059e-01,  1.00000e+00,          nan,          nan,
                 nan,          nan,          nan,          nan],
       [ 4.96995e-25,  4.18154e-25,  1.00000e+00,          nan,
                 nan,          nan,          nan,          nan],
       [ 9.52700e-17,  0.00000e+00,  0.00000e+00,  1.00000e+00,
                 nan,          nan,          nan,          nan],
       [ 3.45561e-34,  7.92386e-34,  1.85179e-57,  0.00000e+00,
         1.00000e+00,          nan,          nan,          nan],
       [ 1.84261e-01,  8.12273e-01, -9.55356e-25, -6.28313e-16,
         0.00000e+00,  1.00000e+00,          nan,          nan],
       [ 0.00000e+00, -5.76860e-25,  5.69754e-01,  4.26956e-40,
         0.00000e+00,  0.00000e+00,  1.00000e+00,          nan],
       [ 1.55645e-16,  9.56506e-17,  4.26956e-40,  5.69754e-01,
         0.00000e+00,  0.00000e+00,  0.00000e+00,  1.00000e+00]])
```
